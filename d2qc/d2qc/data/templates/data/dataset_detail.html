{% extends "base.html" %}
{% block css %}
<link rel="stylesheet" type="text/css"
href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v5.3.0/css/ol.css">
<style>
    #map {
        height: 500px;
        width: 500px;
    }
    .dataset.data{
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .dataset.data .selected,
    .dataset.data .selected a {
        background-color: black;
        color: white;
        font-weight: bold;
    }
</style>
{% endblock %}
{% block js %}
<script type="text/javascript"
src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v5.3.0/build/ol.js">
</script>
{% endblock%}
{% block content %}
    <div>
        <h3>
            ID: {{ object.id }} - {{ object.expocode }}
        </h3>
        {% if object.is_reference %}
        <h4>
            This data set is a reference data set
        </h4>
        {% endif %}
        <div class="dataset data">
            <dl>
                <dt>ID</dt>
                <dd>{{ object.id }}</dd>
                <dt>Expocode</dt>
                <dd>{{ object.expocode }}</dd>
                <dt>Parent file</dt>
                <dd>{{ object.data_file.name }}</dd>
                <dt>Variables in this data set
                </dt>
                <dd>
                    <table border="1" cellpadding="5">
                        <thead>
                            <tr>
                                    <th>Variable name</th>
                                    <th>Identifier from BODC vocabulary</th>
                                </tr>
                        </thead>
                        <tbody>
                            {% for data_type in data_types %}
                            <tr
                            {% if parameter.id == data_type.id %}
                            class="selected"
                            {% endif %}
                            >
                                <td>
                                    <a
                                        href="{% url 'data_set_parameter-detail' object.id data_type.id %}"
                                    >
                                        {{ data_type.original_label }}
                                    </a>
                                </td>
                                <td>{{ data_type.identifier }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </dd>
            </dl>
            <div>
                <h4>
                    {% if parameter %}
                    Stations with {{ parameter.original_label }} sampling
                    {% else %}
                    All stations
                    {% endif %}
                </h4>
                <div id="map">
                </div>
                <a href="{% url 'data_set-detail' object.id %}">
                        [Show all stations]
                </a>
            </div>
        </div>
        <script type="text/javascript">

            var raster = new ol.layer.Tile({
                source: new ol.source.OSM()
            });
            var wkt = '{{ stations }}';
            var crossovers = '{{ crossovers }}';
            var features = []
            red = new ol.style.Style({
                image: new ol.style.Circle({
                    fill: new ol.style.Fill({
                        color: [255,0,0,.4]
                    }),
                    radius: 3,
                })
            });
            blue = new ol.style.Style({
                image: new ol.style.Circle({
                    fill: new ol.style.Fill({
                        color: [0,0,255,1]
                    }),
                    radius: 3,
                })
            });


            var format = new ol.format.WKT();

            var feature = format.readFeature(wkt, {
                dataProjection: 'EPSG:4326',
                featureProjection: 'EPSG:3857'
            });
            feature.setStyle(blue)
            var cross_feature = null
            if (crossovers) {
                cross_feature = format.readFeature(crossovers, {
                    dataProjection: 'EPSG:4326',
                    featureProjection: 'EPSG:3857'
                });
                cross_feature.setStyle(red);
                features.push(cross_feature)
            }
            // Add stations from data set on top of crossovers
            features.push(feature)
            var source = new ol.source.Vector({
                features: features
            })
            var vector = new ol.layer.Vector({
                source: source
            });

            var map = new ol.Map({
                layers: [raster, vector],
                target: 'map',
                view: new ol.View({
                center: [2952104.0199, -3277504.823],
                zoom: 4
                })
            });
            map.getView().fit(source.getExtent(), map.getSize())
            map.getView().setZoom(map.getView().getZoom() - 1)
          </script>

        <a href="{% url 'data_set-delete' object.id %}">[Delete]</a>
    </div>
{% endblock %}
